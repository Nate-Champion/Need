<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeadlineTracker</title>

    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome Icons (via CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Poppins Font (via Google Fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { font-family: "Poppins", sans-serif; }
        .badge { padding: 0.25em 0.8em; font-size: 0.75rem; font-weight: 700; border-radius: 0.5rem; }
        .fade-in { animation: fadeIn .4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
        .completed-card { order: 9999; opacity: 0.7; background-color: rgba(31, 41, 55, 0.4) !important; }
        .checkbox-wrapper { display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .custom-checkbox { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #4b5563; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .custom-checkbox.checked { background-color: #10b981; border-color: #10b981; }
        .custom-checkbox.checked::after { content: '00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 14px; }
        body:not(.dark) .custom-checkbox { border-color: #d1d5db; }
        body:not(.dark) .completed-card { background-color: rgba(243, 244, 246, 0.5) !important; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 dark transition min-h-screen flex flex-col">

    <nav class="bg-gray-800 shadow-md sticky top-0 z-50 transition">
        <div class="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">

            <div class="flex items-center gap-3">
                <i class="fa-solid fa-calendar-day text-2xl text-indigo-500"></i>
                <h1 class="text-xl font-bold">Deadline<span class="text-indigo-500">Tracker</span></h1>
            </div>

            <div class="flex items-center gap-4">
                <button id="sync-btn" class="px-3 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-white text-sm flex items-center gap-2">
                    <i class="fa-solid fa-rotate"></i> Sync
                </button>

                <button id="theme-toggle" class="text-xl p-2 rounded-lg bg-gray-700 transition hover:bg-gray-600">
                    <i id="theme-icon" class="fa-solid fa-sun text-yellow-500"></i>
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-8 flex-grow w-full">
        <div id="loader" class="text-center py-10 hidden">
            <div class="animate-spin h-12 w-12 border-t-4 border-b-4 border-indigo-600 rounded-full mx-auto"></div>
            <p class="mt-4 text-gray-500">Syncing data...</p>
        </div>

        <div id="assignment-container" class="grid gap-4"></div>
        <div id="empty-state" class="hidden text-center py-20">
            <i class="fa-regular fa-clipboard text-6xl text-gray-700 mb-4"></i>
            <h3 class="text-lg font-medium">No assignments found</h3>
        </div>
    </main>

    <footer class="text-center py-6 text-sm text-gray-500 border-t border-gray-700 mt-auto">
        &copy; 2025 DeadlineTracker
    </footer>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTzkyidBhfigPvat3WEZFh6IhblU1GPSZIiPAeI27ALZ4yfoxzfHiji3HtczzYHTS-b3d3dj1iYmHSu/pub?gid=0&single=true&output=csv";

        let allAssignments = [];
        let completedAssignments = new Set();
        let showCompleted = true;

        document.addEventListener("DOMContentLoaded", () => {
            initTheme();
            loadCompletedFromStorage();
            manualSync();
            document.getElementById("sync-btn").addEventListener("click", manualSync);
            setInterval(autoSync, 5 * 60 * 1000);
        });

        function manualSync() { fetchCSV(true); }
        function autoSync() { fetchCSV(false); }

        function fetchCSV(showLoader) {
            if (showLoader) document.getElementById("loader").classList.remove("hidden");

            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                complete: function(result) {
                    allAssignments = result.data.map(row => ({
                        id: row.ID,
                        className: row.Class,
                        title: row.Title,
                        desc: row.Description,
                        priority: row.Priority,
                        date: row.Date,
                        daysLeft: parseInt(row.DaysLeft)
                    }));

                    filterData();
                    if (showLoader) document.getElementById("loader").classList.add("hidden");
                }
            });
        }

        function initTheme() {
            const icon = document.getElementById("theme-icon");
            const toggleButton = document.getElementById("theme-toggle");
            document.documentElement.classList.add("dark");
            icon.classList.add("fa-sun");
            toggleButton.onclick = () => {
                const isDark = document.documentElement.classList.toggle("dark");
                icon.classList.replace(isDark ? "fa-moon" : "fa-sun", isDark ? "fa-sun" : "fa-moon");
            };
        }

        function loadCompletedFromStorage() {
            const stored = localStorage.getItem("completedAssignments");
            if (stored) completedAssignments = new Set(JSON.parse(stored));
        }

        function saveCompletedToStorage() {
            localStorage.setItem("completedAssignments", JSON.stringify([...completedAssignments]));
        }

        function toggleCompletion(id) {
            if (completedAssignments.has(id)) completedAssignments.delete(id);
            else completedAssignments.add(id);
            saveCompletedToStorage();
            filterData();
        }

        function filterData() {
            const filtered = allAssignments;
            renderAssignments(filtered);
        }

        function renderAssignments(data) {
            const container = document.getElementById("assignment-container");
            container.innerHTML = "";

            if (data.length === 0) {
                document.getElementById("empty-state").classList.remove("hidden");
                return;
            }
            document.getElementById("empty-state").classList.add("hidden");

            data.forEach(item => container.appendChild(createCard(item)));
        }

        function createCard(item) {
            const isCompleted = completedAssignments.has(item.id);
            const card = document.createElement("div");
            card.className = `bg-gray-800 p-5 rounded-xl shadow border border-gray-700 fade-in`;

            card.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <h4 class="text-lg font-semibold ${isCompleted ? 'line-through text-gray-500' : 'text-white'}">${item.title}</h4>
                        <p class="text-sm text-gray-400">${item.className}</p>
                        <p class="text-xs text-gray-500 mt-1">${item.date} â€” <span class="font-bold">${item.daysLeft} days</span></p>
                    </div>

                    <div class="custom-checkbox ${isCompleted ? 'checked' : ''}" data-id="${item.id}"></div>
                </div>
            `;

            card.querySelector('.custom-checkbox').addEventListener('click', () => toggleCompletion(item.id));

            return card;
        }
    </script>

</body>
</html>
